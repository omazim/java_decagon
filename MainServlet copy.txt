import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.util.Iterator;

import javax.servlet.ServletContextListener;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.json.JSONObject;

public class MainServlet extends HttpServlet implements ServletContextListener {

  private String getBody (HttpServletRequest request)  {

    String body = null;
    StringBuilder stringBuilder = new StringBuilder();
    BufferedReader bufferedReader = null;

    try {
      InputStream inputStream = request.getInputStream();
      if (inputStream != null) {
          bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
          char[] charBuffer = new char[128];
          int bytesRead = -1;
          while ((bytesRead = bufferedReader.read(charBuffer)) > 0) {
              stringBuilder.append(charBuffer, 0, bytesRead);
          }
      } else {
          stringBuilder.append("");
      }
    } catch (IOException ex) {
        // throw ex;
        return "";
    } finally {
      if (bufferedReader != null) {
        try {
          bufferedReader.close();
        } catch (IOException ex) {

        }
      }
    }

    body = stringBuilder.toString();
    return body;
  }

  public void contextInitialized () {
    
  }

  @Override
  protected void doPost (HttpServletRequest req, HttpServletResponse res)
  throws ServletException, IOException {
    
    
    // Parse incoming JSON from the body.
    String body = getBody(req);
    JSONObject jObj = new JSONObject(body);

    Iterator<String> it = jObj.keys();
    String html = "";
    while(it.hasNext())
    {
      String key = it.next(); // get key
      Object o = jObj.get(key); // get value
      System.out.println(key + " : " +  o); // print the key and value
      html += key + " : " +  o;
    }
    
    PrintWriter pw = res.getWriter();
    res.setContentType("text/html");
    res.setContentType("text/html");

    // PrintWriter out = response.getWriter();
    // response.setContentType("application/json");
    // response.setCharacterEncoding("UTF-8");
    // out.print(employeeJsonString);
    // out.flush();
    
    // String user=req.getParameter("userName");
    // String pass=req.getParameter("userPassword");
    
    pw.println("Login Success...!" + html);
    // if (user.equals("edureka") && pass.equals("edureka")) {

      // pw.println("Login Success...!");
    // } else {
      
    //   pw.println("Login Failed...!");
      pw.close();
    // }  
  }  
}

// @WebServlet(name = "EmployeeServlet", urlPatterns = "/employeeServlet")
// public class EmployeeServlet extends HttpServlet {

//     private Gson gson = new Gson();

//     @Override
//     protected void doGet(
//       HttpServletRequest request, 
//       HttpServletResponse response) throws IOException {
        
//         Employee employee = new Employee(1, "Karan", "IT", 5000);
//         String employeeJsonString = this.gson.toJson(employee);

//         PrintWriter out = response.getWriter();
//         response.setContentType("application/json");
//         response.setCharacterEncoding("UTF-8");
//         out.print(employeeJsonString);
//         out.flush();   
//     }
// }